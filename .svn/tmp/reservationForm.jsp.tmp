<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
    <%
    request.setCharacterEncoding("UTF-8");
    %>
<!DOCTYPE html>
<html lang="ko">
<head>
<style>
       #sideBar {
        	border-style: solid;
            position: absolute;
            top: 200px;
            width: 150px;
        }
        #ad {
        	border-style: solid;
            position: absolute;
            top: 550px;
            height: 150px;
            width: 150px;
            background-color: aqua;
        }
    </style>
<meta charset="UTF-8">
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<!-- 아래 제이쿼리는 1.0이상이면 원하는 버전을 사용하셔도 무방합니다. -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>

<title>Insert title here</title>
</head>
<body>
<%@include file="/WEB-INF/inc/top.jsp"%>
<%@ include file="/WEB-INF/inc/ReservationSidebar.jsp"%>
<div class="container">
	<div class="page-header">
		<h3>예약 게시판</h3>
	</div>
	<form:errors path="reservation.*" />
	<form:form action="" modelAttribute="member">
	<pre>${member }</pre>
	<div class="row wifi" >
            <div class="col-md-4">예약일자</div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-4">수령일<input type="date" id="startDate" class="form-control" name=""></div>
            <div class="col-md-4 wifi">반납일<input type="date" id="endDate" class="form-control"></div>
            <div class="col-md-3 wifi">이용기간
         <input type="text" class="form-control" readonly="readonly" value="" id="daysOfTravel"></div>
        </div>
        <div class="row usim">
            <div class="col-md-4">World USIM</div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row usim">
            <div class="col-md-1"></div>
            <div class="col-md-5">
                유심선택
                <select onchange="fn_calcS(this)" class="form-control">
                    <option>선택하세요</option>
                    <option value = '100'>World USIM 3일 무제한 데이터/통화/문자</option>
                    <option value = '200'>World USIM 5일 무제한 데이터/통화/문자</option>
                    <option value = '300'>World USIM 7일 무제한 데이터/통화/문자</option>
                    <option value = '400'>World USIM 10일 무제한 데이터/통화/문자</option>
                    <option value = '500'>World USIM 15일 무제한 데이터/통화/문자</option>
                    <option value = '600'>World USIM 30일 무제한 데이터/통화/문자</option>
                </select>
                 <div class="col-md-1"></div>
            </div>
        </div>
        <div class="row">
        	<div class="col-md-4">예약자 성함</div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-11"><form:input path="memName" cssClass="form-control" /></div>
        </div>
        <div class="row">
        	<div class="col-md-4">예약자 이메일</div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-11"><form:input path="memMail" cssClass="form-control" /></div>
        </div>
        <div class="row">
        	<div class="col-md-4">예약자 연락처 </div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-11"><form:input path="memHp" cssClass="form-control"/></div>
        </div>
        
        <div class="row">
        	<div class="col-md-4">예약자 주소 </div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-11"><input type="text" class="form-control" value="${member.memAdd1} ${member.memAdd2}"></div>
        </div>
        
        <div class="row">
        	<div class="col-md-4">예약자 우편번호 </div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-11"><form:input path="memZip" cssClass="form-control" /></div>
        </div>
        <div class="row">
        	<div class="col-md-6">수량</div>
        </div>
        <div class="row">
	        <div class="col-md-1"></div>
	        <div class="col-md-5"><input type="number" id="count" onchange="fn_sum()" class="form-control"></div>
	        <div class="col-md-1"></div>
	        <div class="col-md-5 wifi"><label for="wifi">와이파이 보험 선택 여부<input type="checkbox" id="wifi" value = '100' onclick="fn_calc(this)"></label></div>
        </div>
        

        <div class="row wifi">
            <div class="col-md-4">옵션</div>
            <div class="col-md-4"></div>
            <div class="col-md-4"></div>
        </div>
        <div class="row wifi">
            각각을 대여하시면 보증금 1000원을 지불하셔야 하며, 와이파이 반납 시 보증금이 환불됩니다.
        </div>
        <div class="row wifi">
            <div class="col-md-4">
                <p><input type="checkbox"  id="battery" value = '100' onclick="fn_calc(this)"><label for="battery">보조배터리</label></p>
                
                <img src="<%=request.getContextPath()%>/resources/image/battery.png">
                <p>포켓와이파이 2회 충전가능</p>
            </div>
            <div class="col-md-4">
                <p><input type="checkbox" id="multi" value = '100' onclick="fn_calc(this)"><label for="multi"> USB 멀티 충전기</label></p>
                <img src="<%=request.getContextPath()%>/resources/image/mplug.png">
                <p>전원 플러그 1개로 최대 5대를 고속 충전할 수 있는 멀티 충전기</p>
            </div>
            <div class="col-md-4">
                <p><p><input type="checkbox" id="usb" value = '100' onclick="fn_calc(this)"><label for="usb"> 5핀 USB 케이블</label></p></p>
                <img src="<%=request.getContextPath()%>/resources/image/5pin.png">
                <p>포켓 와이파이 충전과 데이터 전송에 사용할 수 있는 USB 케이블</p>
            </div>
        </div>

</form:form>
	<div class="row">
		<div class="col-md-4">
			지불하실 금액 (원)<input type="text" class="form-control" readonly="readonly" id="sumtext">
			</div> 
		<div class="col-md-4">
			
		</div>
		<div class="col-md-4"></div>
	</div>
	<div class="row">
		<button class="btn btn-primary" onclick="iamport()">결제하기</button>
	</div>
</div> <!-- end .container -->
<script>
// 1. 전역변수 선언 


// 2. 일반함수 선언 
	function iamport(){
		//가맹점 식별코드
		IMP.init('imp85907964');
		IMP.request_pay({
		    pg : 'kcp',
		    pay_method : 'card',
		    merchant_uid : 'merchant_' + new Date().getTime(),
		    name : '상품1' , //결제창에서 보여질 이름
		    amount : 100, //실제 결제되는 가격 $("#sumtext").val()
		    buyer_email : 'iamport@siot.do',
		    buyer_name : '구매자이름',
		    buyer_tel : '010-1234-5678',
		    buyer_addr : '서울 강남구 도곡동',
		    buyer_postcode : '123-456'
		}, function(rsp) {
			console.log(rsp);
			// 결제검증
			$.ajax({
	        	type : "POST",
	        	url : "/Reservation/reservationForm/" + rsp.imp_uid 
	        }).done(function(data) {  
	        	
	        	console.log(data);
	        	
	        	// 위의 rsp.paid_amount 와 data.response.amount를 비교한후 로직 실행 (import 서버검증)
	        	if(rsp.paid_amount == data.response.amount){
		        	alert("결제 및 결제검증완료");
		        	//저장하는 ajax를 만들기
	        	} else {
	        		alert("결제 실패");
	        	}
	        });
		});
	}
	
	
	// 3. 이벤트 함수 선언 
	
	$("#endDate").change(function(){
	    $("#daysOfTravel").val(betweenDay($("#endDate").val(),$("#startDate").val()));
	});
	function betweenDay(firstDate, secondDate){
	     var firstDateObj = new Date(firstDate.substring(0, 4), firstDate.substring(5, 7) - 1, firstDate.substring(8, 10));
	     var secondDateObj = new Date(secondDate.substring(0, 4), secondDate.substring(5, 7) - 1, secondDate.substring(8, 10));
	    
	     if(secondDateObj>firstDateObj){
	         alert("도착날짜는 출발날짜보다 이후이어야 합니다");
	         return ;
	     }
	    
	     var betweenTime = Math.abs(secondDateObj.getTime() - firstDateObj.getTime());
	     return Math.floor(betweenTime / (1000 * 60 * 60 * 24))+'일';
	} // end betweenDay
	
window.onload = function fn_showPage(){
		if("${gubun}" == "wifi"){
			$(".usim").hide();
<<<<<<< .mine
			$("#sumtext").val("100")
||||||| .r113
=======
			$("#sum`text").val(100)
>>>>>>> .r125
		}else if("${gubun}" == "usim"){
			$(".wifi").hide();
		}
			
	}
	
	var sum = 100;
	function fn_sum(){
	var sum = document.getElementById('sumtext').value;
	var count = document.getElementById('count').value;
	sum = sum * count;
	document.getElementById('sumtext').value = sum;
	}
	
	function fn_calc(obj){
		if(obj.checked){
			sum += parseInt(obj.value);
<<<<<<< .mine
||||||| .r113
=======
		}else if(obj.options.selected = "selected"){
			sum = parseInt(obj.value);
>>>>>>> .r125
		}else{
			sum -= parseInt(obj.value);
		}
			fn_sum();
	}
	
	function fn_calcS(obj){
		if(obj.options.selected = "selected"){
			sum = parseInt(obj.value);
		}
			fn_sum();
	}
	
	
	// 4. 초기화 
</script>
</body>
</html>