<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<%@ include file="/WEB-INF/inc/top.jsp"%>
<title>SignUp</title>
</head>
<body>
<div class="container" style="margin-top: 130px; background-image: linear-gradient(rgba(100, 100, 100, 0.5), rgba(255, 255, 255, 0.5))">
	<form:form action="signupUser.wow" name="frmSignup" method="post" modelAttribute="member" >
	<%-- <form name="frmSignup" action="signupUser.wow" method="post" style="margin-top: 100px;"> --%>
		<div id="frm_assign" align="center" >
		<div class="col-10" >
			<div style="width: auto;height: 200px; overflow: auto; margin-top: 30px " class="form-control">
				<c:import url="/resources/assignment" charEncoding="utf-8" />
			 </div><br>
		</div>
			
			
			<form:checkbox path="memCheckbox" /><span style="font-size:12px; margin-bottom: 10px ">개인정보 수집ㆍ이용에 동의합니다.(필수)</span><br>
			<form:errors path="memCheckbox" /> <br><br>
			<!-- <input name="memCheckbox" type="checkbox" required="required" style=""><span style="font-size:12px; margin-bottom: 10px "> 개인정보 수집ㆍ이용에 동의합니다.(필수)</span></input> -->
		</div>
		<div id="frm_input" align="center" style="margin-top: 30px;"> 
				<span><b>아이디</b></span>
					<form:input path="memId"  id="idDoubleChk" cssClass=""/><br>
					<form:errors path="memId" /> <br>
					<span id="result_id_msg"></span><br><br>
			
				<span><b>비밀번호</b></span>
					<form:password path="memPass" cssClass="" id="pwDoubleChk"/><br>
					<form:errors path="memPass" /> <br><br>
					
				<span><b>비밀번호 확인</b></span>
					<form:password path="memPassChk" cssClass="" id="pwDoubleChk2"/><br>
					<form:errors path="memPassChk" /><br>
					<span id="result_pw_msg"></span><br><br>
			
				<span><b>이름</b></span>
					<form:input path="memName" cssClass=""/><br>
					<form:errors path="memName" /> <br><br>
			
				<span><b>생일</b></span> <input type="date" name="memBir" class="" required="required"> <br><br>
			
				<span><b>우편번호</b></span>
					<form:input path="memZip" cssClass=""/><br>
					<form:errors path="memZip" /> <br><br>
			
				<span><b>주소</b></span> 
					<form:input path="memAdd1" cssClass=""/><br>
					<form:errors path="memAdd1" /> <br><br>
			
				<span><b>상세주소</b></span> <input type="text" name="memAdd2" class="" placeholder="상세주소"/> <br><br>
			
				<span><b>핸드폰</b></span>
					<form:input path="memHp" cssClass=""/><br>
					<form:errors path="memHp" /> <br><br>
			
				<span><b>메일</b></span> 
					<form:input path="memMail" cssClass="" id="memMail"/><button type="button" id="sendMailButton" onclick="fn_email()" class="btn btn-sm btn-dark">인증</button><br>
					<input type="text" hidden="" id="mailHidden"><button type="button" hidden="" id="mailButtonHidden" onclick="fn_email_Chk()" class="btn btn-sm btn-dark">인증확인</button>
					<input type="hidden" value="" id="emailnumRepository">
					<input type="hidden" value="false" name="emailNumKeyChecked" id="emailNumKeyChecked">
					<form:errors path="memMail" /> <br><br>
		</div>
		<div align="center" style="margin: 10px; margin-bottom: 100px;">
			<button type="submit" class="btn btn-sm btn-dark"><b>회원가입</b></button>
		</div>
	</form:form>

</div>
<%@ include file="/WEB-INF/inc/footer.jsp"%>
</body><!-- end.container -->
<script type="text/javascript">


//아이디 중복 확인
$(document).ready(function(){
    $('#idDoubleChk').keyup(function(){
        if ( $('#idDoubleChk').val().length > 3) {
            var memId = $(this).val();
            var url = '<c:url value="/signup/findUser.wow"/>';
            // ajax 실행
            $.ajax({
                type : 'POST',				//화면에서 controller로 보내는 정보들
                url : url,					//화면에서 controller로 보내는 정보들
                data: {"memId": memId},		//화면에서 controller로 보내는 정보들
                success : function(data) {	//return에서 데려온 정보
                	if (data === "null") {
                        $("#result_id_msg").html("사용 가능한 아이디 입니다.");
                    } else {
                        $("#result_id_msg").html("사용 불가능한 아이디 입니다.");
                    } 
                }
            }); // end ajax
        }
    }); // end keyup
});



//비밀번호 위에입력한거랑 같은지
$(document).ready(function(){
    $('#pwDoubleChk2').keyup(function(){
        if ( $('#pwDoubleChk2').val().length > 7) {
            var memPw = $('#pwDoubleChk').val();
            var memPassChk = $('#pwDoubleChk2').val();
            
            if(memPw != memPassChk) {
            	$("#result_pw_msg").html("비밀번호가 일치하지 않습니다");
            }else{
            	$("#result_pw_msg").html("비밀번호가 일치합니다");
            }
            
         
        }
    }); // end keyup
});



//메일 실존 확인

function fn_email() {
	//ajax 의 url을 spring Controller의 RequstMapping("") 으로 요청
	var memMail = $("#memMail").val();
	var url = '<c:url value="/email/sendEmail.wow"/>';
	
	$.ajax({
		url: url,		
		data : {"memMail" : memMail },		
		type : "POST",
		success: function(data){ //data = 6자리 랜덤 키
			console.log(data);
			$("#mailHidden").removeAttr("hidden"); // 이메일 인증번호 입력칸 나오게 
			$("#mailButtonHidden").removeAttr("hidden"); // 이메일 인증번호 확인 버튼 나오게 
			$("#emailnumRepository").val(data); // 이메일 인증번호 저장하기 
		},
		error: function(request, status, error){
			alert("에러다에러! 에러 멈춰!");
		}
	}); //ajax
}//fn_email

function fn_email_Chk() {
	//emailnumRepository에 저장된 값 이랑 사용자가 입력한 6자리 숫자 - emailAuthKey 값이 같으면 emailAuthKeyChecked의 value값이 Y로 
	if($("#emailnumRepository").val()==$("#mailHidden").val()){
		$("#emailNumKeyChecked").val("true");
		alert("메일인증이 완료되었습니다.");
	}else {
		alert("인증번호가 일치하지 않습니다.");
	}
	
}



</script>
</html>