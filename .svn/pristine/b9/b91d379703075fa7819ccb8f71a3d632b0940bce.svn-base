<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%
	request.setCharacterEncoding("utf-8");
%>
<!DOCTYPE html>
<html lang="ko">
<style>
#image{ margin:50px 50px;z-index:10;}
#n_id{position:absolute;left:286px;top:200px;z-index:20;}
#prize{display: inline-block;
 	   position: absolute;
  	   margin-top: 20px;
  	   font-size: xx-large;
  	   }
</style>
</head>
<body>
<%@ include file="/WEB-INF/inc/top.jsp"%>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="<%=request.getContextPath() %>/resources/roulette/jQueryRotateCompressed.js"></script>
<div style="margin-top: 100px">
<div style="display: inline-block">
<img src="<%=request.getContextPath() %>/resources/roulette/roulette.png" id="image">
<img src="<%=request.getContextPath() %>/resources/roulette/niddle.png" id="n_id">
</div>
<div id="prize">
대박 룰렛 <br>
필요 마일리지:10000<br>
1: 10000000 마일리지<br>
2: 8000000 마일리지 <br>
3: 7000000 마일리지<br>
꽝: 꽝  <br>
5: 30000 마일리지 <br>
6: 60000 마일리지 <br>
7: 20000 마일리지 <br>
8: 15000 마일리지  <br>
9: 10000 마일리지<br>
0: 1000 마일리지  <br>
</div>
</div>




<script>
window.onload = function(){
	var randomNum,real_angle,part,curMileage,mileage;
	var requiredMileage=10000;
	$('#image').click(function(){
		$.ajax({
			type :"GET",
			url : "<c:url value='/event/mileagecheck'/>",	
			dataType : 'json',
			data : {
				memId:'${member.memId}',
				requiredMileage: requiredMileage
			},		
			success :function(data){
				if(data.result){
					curMileage = data.curMileage;
					$('#result_id4').html("내 마일리지: "+(curMileage-requiredMileage));
					console.log(curMileage-requiredMileage);
					 randomNum= random();
					 real_angle = randomNum%360 +18;
					 part = Math.floor(real_angle/36);
					 if(part==1){mileage = 10000000;}
					 if(part==2){mileage = 8000000;}
					 if(part==3){mileage = 7000000;}
					 if(part==4){mileage = 0;}
					 if(part==5){mileage = 30000;}
					 if(part==6){mileage = 60000;}
					 if(part==7){mileage = 20000;}
					 if(part==8){mileage = 15000;}
					 if(part==9){mileage = 10000;}
					 if(part==0){mileage = 1000;}
				  $.ajax({
							type :"GET",
							url : "<c:url value='/event/mileage'/>",	
							//dataType : 'json',
							data : {
								memId:'${member.memId}',
								memMileage: curMileage+mileage-requiredMileage,
								requiredMileage: 300
							},		
							success :function(data){
									rotation();
								}//success 
							});  //mileage ajax --end
				}else{ //마일리지 부족으로 실패
				alert(data.msg)	
				}
				}
			});  // mileage check ajax --end
	});// image click function --end
	function rotation(){
		$("#image").rotate({
		  angle:0, 
		  animateTo:360 * 5 + randomNum, 
		  center: ["50%", "50%"],
		  easing: $.easing.easeInOutElastic,
		  callback: function(){ 
						var n = $(this).getRotateAngle();
						endAnimate(n);
					},
		  duration:2000
	   });
	}

	function endAnimate(){
		$('#prize').html("<p>" + mileage + " 마일리지 획득!!!</p><br>내 마일리지: "+(curMileage+ mileage-requiredMileage));
	}

	function random(){
		var a= Math.floor(Math.random()*1000);
		if(a==1000){
			return 36*1;
		}else if(a==999) {
		return 36*2;
		}else if(a==998) {
		return 36*3;
		}else if(a<=250) {
		return 36*10;
		}else if(a>501 && a<=550) {
		return 36*5;
		}else if(a>601 && a<=650) {
		return 36*6;
		}else if(a>701 && a<=750) {
		return 36*7;
		}else if(a>801 && a<=850) {
		return 36*8;
		}else if(a>901 && a<=950) {
		return 36*9;
		}else{
		return 36*4;
		}
	}//random
};
</script>
<%@ include file="/WEB-INF/inc/footer.jsp"%>
</body>
</html>