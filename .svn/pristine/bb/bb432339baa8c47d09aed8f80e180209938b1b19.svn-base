<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
    <%
    request.setCharacterEncoding("UTF-8");
    %>
<!DOCTYPE html>
<html lang="ko">
<head>
<style>
       #sideBar {
        	border-style: solid;
            position: absolute;
            top: 200px;
            width: 150px;
        }
        #ad {
        	border-style: solid;
            position: absolute;
            top: 550px;
            height: 150px;
            width: 150px;
            background-color: aqua;
        }
    </style>
<meta charset="UTF-8">
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<!-- 아래 제이쿼리는 1.0이상이면 원하는 버전을 사용하셔도 무방합니다. -->
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<title>Insert title here</title>
</head>
<body>
<%@include file="/WEB-INF/inc/top.jsp"%>
<div style="height: 120px"></div>
<div class="container">
	<div class="page-header">
		<h3>예약내역</h3>
	</div>
		<form:form action="reservationAdminModify" modelAttribute="reserve" method="post">
		<form:hidden path="reMerchantUid"/>
		<form:hidden path="reTop"/>
		                   
		<table class="table table-striped table-bordered">
			<tbody>
				<tr>
					<th>주문번호</th>
					<td><form:input path="bookMerchantUid" cssClass="form-control input-sm" readonly="true"/></td>
				</tr>
				<tr>
					<th>구매항목</th>
					<td>${reserve.bookCdNm}</td>
				</tr>
				<tr>
					<th>구매자 이메일</th>
					<td><form:input path="bookBuyerEmail" cssClass="form-control input-sm"/></td>
				</tr>
				<tr>
					<th>구매자명</th>
					<td><form:input path="bookBuyerName" cssClass="form-control input-sm"/></td>
				</tr>
				<tr>
					<th>구매자 연락처</th>
					<td><form:input path="bookBuyerTel" cssClass="form-control input-sm"/></td>
				</tr>
				<tr>
					<th>구매자 주소</th>
					<td><form:input path="bookBuyerAddr" cssClass="form-control input-sm"/></td>
				</tr>
				<tr>
					<th>구매자 우편번호</th>
					<td><form:input path="bookBuyerPostcode" cssClass="form-control input-sm"/></td>
				</tr>
					<c:if test="${reserve.bookCdNm ne '마일리지'}"> <!-- 마일리지가 아닐경우 -->
				<tr>
					<th>수령방법</th>
					<td><c:set var="bookReceiveWay" value="${reserve.bookReceiveWay}" />
							<form:select path="bookReceiveWay" id="pickupway"
								cssClass="form-control input-sm" onchange="fn_shipping()">
								<form:option value="">-------------</form:option>
								<form:options items="${pickup}" itemValue="commCd" itemLabel="commNm" />
							</form:select>
					</td>
				</tr>
				<tr>
					<th>수령공항</th>
						<td><c:set var="bookPickupAir" value="${reserve.bookPickupAir}" /> 
								<form:select path="bookPickupAir" id="pickupair" cssClass="form-control input-sm">
								<form:option value="">-------------</form:option>
								<form:options items="${airport}" itemValue="commCd"	itemLabel="commNm" />
							</form:select></td>
					</tr>
				<tr>
					<th>수령일</th>
					<td><input type="date" id="startDate" class="form-control" name="bookReceive" value="${reserve.bookReceive}"></td>
				</tr>
				<tr>
					<th>반납방법</th>
					<td>
					<c:set var="bookReturnWay" value="${reserve.bookReturnWay}" /> 
						<form:select path="bookReturnWay" id="returnway" cssClass="form-control input-sm" onchange="fn_shipping()">
								<form:option value="">-------------</form:option>
								<form:options items="${pickup}" itemValue="commCd" itemLabel="commNm" />
						</form:select>
					</td>
				</tr>
				<tr>
					<th>반납공항</th>
						<td><c:set var="bookReturnAir" value="${reserve.bookReturnAir}" /> 
								<form:select path="bookReturnAir" id="returnair" cssClass="form-control input-sm">
								<form:option value="">-------------</form:option>
								<form:options items="${airport}" itemValue="commCd" itemLabel="commNm" />
							</form:select></td>
					</tr>
				<tr>
					<th>반납일</th>
					<td><input type="date" id="endDate" class="form-control" name="bookReturn" value="${reserve.bookReturn}"></td>
				</tr>
				<tr>
					<th>가격</th>
					<td><form:input path="bookAmount" cssClass="form-control" id="sumtext"/></td>
				</tr>
				<tr>
					<th>와이파이</th>
					<td>
						<div>
							<c:set var="PK01_YN" value="N" />
			                <c:set var="PK02_YN" value="N" />
			                <c:set var="PK03_YN" value="N" />
			                <c:set var="PK04_YN" value="N" />	
			                <c:forEach items="${reserveOption }" var="check">
			                	<c:if test='${check.reLow == "PK01"}'><c:set var="PK01_YN" value="Y" /></c:if>
			                	<c:if test='${check.reLow == "PK02"}'><c:set var="PK02_YN" value="Y" /></c:if>
			                	<c:if test='${check.reLow == "PK03"}'><c:set var="PK03_YN" value="Y" /></c:if>
			                	<c:if test='${check.reLow == "PK04"}'><c:set var="PK04_YN" value="Y" /></c:if>			                		
			                </c:forEach>
					  <div class="col-md-3">
			                <p>
			                <label>		
			                <input type="checkbox" name="reLows" class="battery" value ="PK01" ${PK01_YN eq 'Y' ? "checked='checked'":"" } onclick="fn_calc(this)">
			                보조배터리</label></p>
			                <img src="<%=request.getContextPath()%>/resources/image/battery.png">
			                <p>포켓와이파이 2회 충전가능</p>
			            </div>
			            <div class="col-md-3">
			                <p><label>
			                <input type="checkbox" name="reLows" class="battery" value ="PK03" ${PK03_YN eq 'Y' ? "checked='checked'":"" } onclick="fn_calc(this)">
			                USB 멀티 충전기</label></p>
			                <img src="<%=request.getContextPath()%>/resources/image/mplug.png">
			                <p>전원 플러그 1개로 최대 5대를 고속 충전할 수 있는 멀티 충전기</p>
			            </div>
			            <div class="col-md-3">
			                <p><p><label>
			                <input type="checkbox" name="reLows" class="battery" value ="PK02" ${PK02_YN eq 'Y' ? "checked='checked'":"" } onclick="fn_calc(this)">
			                5핀 USB 케이블</label></p>
			                <img src="<%=request.getContextPath()%>/resources/image/5pin.png">
			                <p>포켓 와이파이 충전과 데이터 전송에 사용할 수 있는 USB 케이블</p>
			            </div>
			            <div class="col-md-3">
			            <label>
			            <input type="checkbox" name="reLows" class="battery" value ="PK04" ${PK04_YN eq 'Y' ? "checked='checked'":"" } onclick="fn_calc(this)">
			            와이파이 보험 선택 여부</label>
	       				</div>
			            </div>
					</td>
				</tr>
				<tr>
				<th>유심선택</th>
				<td>
					<div>
	                <c:set var="reLow" value="${reserveOption[0].reLow}"/>
		            <select name="reLows" id="usim" class="form-control input-sm" onchange="fn_calcS()">
		            	<option value="">-------------</option>
		            <c:forEach items="${usoption }" var="code">
		            <option value="${code.commCd}" ${code.commCd eq reLow ? "selected='selected'":"" }>${code.commNm }</option>
		            </c:forEach>
		            </select>
		            </div>
					</td>
				</tr>	
					</c:if>
				<tr>
					<th>주문자 수령여부</th>
					<td>
						<input type="radio" name="bookPickupYn" value="Y" ${reserve.bookPickupYn eq 'Y' ? "checked='checked'":""} >예
						<input type="radio" name="bookPickupYn" value="N" ${reserve.bookPickupYn ne 'Y' ? "checked='checked'":""}>아니오
					</td>
				</tr>
				<tr>
					<th>택배발송여부</th>
					<td>
						<input type="radio" name="bookShippingYn" value="Y" ${reserve.bookShippingYn eq 'Y' ? "checked='checked'":""} >예
						<input type="radio" name="bookShippingYn" value="N" ${reserve.bookShippingYn ne 'Y' ? "checked='checked'":""}>아니오
					</td>
				</tr>
				<tr>
					<th>주문자 반납여부</th>
					<td>
						<input type="radio" name="bookReturnYn" value="Y" ${reserve.bookReturnYn eq 'Y' ? "checked='checked'":""} >예
						<input type="radio" name="bookReturnYn" value="N" ${reserve.bookReturnYn ne 'Y' ? "checked='checked'":""}>아니오
					</td>
				</tr>
				<tr>
					<th>구매취소여부</th>
					<td>						
						<input type="radio" name="bookDel" value="Y" ${reserve.bookDel eq 'Y' ? "checked='checked'":""} >예
						<input type="radio" name="bookDel" value="N" ${reserve.bookDel ne 'Y' ? "checked='checked'":""}>아니오					
					</td>
				</tr>			
				
				<tr>
					<td colspan="2">
					  <div class="pull-left">
							<a href="reservationList.wow" class="btn btn-default btn-sm"> 
								<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
								&nbsp;&nbsp;목록
							</a>
						</div>
						<div class="pull-right">
							<button type="submit" class="btn btn-sm btn-primary" > 
			                <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
			                &nbsp;&nbsp;저장
			              </button>
						</div>
					</td>					  
				</tr>
			</tbody>
		</table>
		</form:form>
</div> <!-- end .container -->
<script>
$("#endDate").change(function(){
    $("#daysOfTravel").val(betweenDay($("#endDate").val(),$("#startDate").val()));
});
function betweenDay(firstDate, secondDate){
     var firstDateObj = new Date(firstDate.substring(0, 4), firstDate.substring(5, 7) - 1, firstDate.substring(8, 10));
     var secondDateObj = new Date(secondDate.substring(0, 4), secondDate.substring(5, 7) - 1, secondDate.substring(8, 10));
    
     if(secondDateObj>firstDateObj){
         alert("도착날짜는 출발날짜보다 이후이어야 합니다");
         return ;
     }
    
     var betweenTime = Math.abs(secondDateObj.getTime() - firstDateObj.getTime());
     return Math.floor(betweenTime / (1000 * 60 * 60 * 24))+'일';
} // end betweenDay


var ea = 100;
var pickupway = 0;
var returnway = 0;
function fn_sum(){
var count = document.getElementById('count').value;
sum = (ea * count) + pickupway + returnway;
	if(count<1){
		alert("수량은 0개 이하일수 없습니다")
		return;
	}	
document.getElementById('sumtext').value = sum;
}

function fn_calc(obj){
	if(obj.checked){
		ea += 100;
	}else{
		ea -= 100;
	}
	fn_sum();
}

function fn_calcS(){     //유심계산
	      if($("#usim").val() == "US01"){
		ea = 100;                   
	}else if($("#usim").val() == "US02"){
		ea = 200;                   
	}else if($("#usim").val() == "US03"){
		ea = 300;                   
	}else if($("#usim").val() == "US04"){
		ea = 400;                   
	}else if($("#usim").val() == "US05"){
		ea = 500;                   
	}else if($("#usim").val() == "US06"){
		ea = 600;
	}
	fn_sum();
}

function fn_shipping() { //택배계산
	if($("#pickupway").val() === "PI01"){ //택배일 때
		pickupway = 2500;
		$("#pickupair").attr("disabled", true);
	}if($("#returnway").val() === "PI01"){ //택배일 때
		returnway = 2500;
		$("#returnair").attr("disabled", true);
	}if($("#pickupway").val() === "PI02"){ //공항일 때
		pickupway = 0;
		$("#pickupair").attr("disabled", false);
	}if($("#returnway").val() === "PI02"){ //공항일 때
		returnway = 0;
		$("#returnair").attr("disabled", false);
	}
	fn_sum();
}

</script>
</body>
</html>